## 引言

> 应用程序读取磁盘文件的过程中，是需要调用操作系统指令，让操作系统先从磁盘读区到内存，然后再从内存拷贝到应用程序，所谓的零拷贝技术就是**避免**CPU将数据从一块存储拷贝到另外一块存储，让CPU解脱出来专注于别的任务。



![](/assets/272719-9b800f62a9c0e47d.png)

## 零拷贝的实现

零拷贝实际的实现并没有真正的标准，取决于操作系统如何实现这一点。零拷贝完全依赖于操作系统。操作系统支持，就有；不支持，就没有。不依赖Java本身。



### 传统IO

```
read(file,tmp_buf,len)
write(socket,tmp_buf,len)
```

1. 程序使用read\(\)系统调用。系统由用户态转换为内核态\(第一次上线文切换\)，磁盘中的数据有DMA（Direct Memory Access\)的方式读取到内核缓冲区\(kernel buffer\)。DMA过程中CPU不需要参与数据的读写，而是DMA处理器直接将硬盘数据通过总线传输到内存中。
1. 系统由内核态转换为用户态（第二次上下文切换），当程序要读取的数据已经完成写入内核缓冲区以后，程序会将数据由内核缓存区，写入用户缓存区），这个过程需要CPU参与数据的读写。
2. 程序使用write\(\)系统调用。系统由用户态切换到内核态\(第三次上下文切换\)，数据从用户态缓冲区写入到网络缓冲区\(Socket Buffer\)，这个过程需要CPU参与数据的读写。
3. 系统由内核态切换到用户态（第四次上下文切换），网络缓冲区的数据通过DMA的方式传输到网卡的驱动\(存储缓冲区\)中\(protocol engine\)

可以看到，传统的I/O方式会经过4次用户态和内核态的切换\(上下文切换\)，两次CPU中内存中进行数据读写的过程。这种拷贝过程相对来说比较消耗资源

  




