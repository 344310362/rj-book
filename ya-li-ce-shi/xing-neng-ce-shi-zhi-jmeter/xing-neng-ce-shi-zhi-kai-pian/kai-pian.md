## 引言

> 进行性能测试的首要任务是了解清楚业务，然后有计划的进行测试。最好能跟市场部的人员确定业务的并发量，压测的环境要跟线上一致才有意义。

## 压测流程

1. 压测需求输入
2. 制定压测计划
3. 了解压测业务
4. 工具脚本准备
5. 进行压测/分析观察
6. 输出压测报告

## 业务

* 单场景业务
* 混合场景业务

## 性能指标

* TPS指标（每秒处理的事务数量）
* 请求响应时间的平均值，最大值，最小值
* 服务器指标变化（内存/磁盘/CPU）
* JVM参数变化（观察垃圾回收活动，年轻代，老年代的内存变化，服务的JVM参数是多少）

## 问题分析排查

观察各个压测指标是否满足测试之初制定的性能指标

* TPS:每秒处理请求的个数

*  90%请求：90%的请求的平均耗时

* Min：最小请求的时间

* Max：耗时最多请求的时间

* 空闲情况下单个请求的时间

* cpu使用情况：理想的情况是不要大于60%

* 内存使用情况：理想的情况是不要大于60%

* 磁盘IO：数据库服务要重点关注

* 网络流量：网关服务要重点关注

* 服务是否有长时间的full gc

借助一系列监控工具初步定位问题，详细验证是否存在以下问题

1. JVM问题
   1. JVM参数不合理
   2. 代码问题
2. 程序问题
   1. 不合理递归
   2. 大对象没有释放
   3. 方法没有处理好
      1. 并发下业务错误（并发的安全问题）
      2. 阻塞导致性能下降
   4. 慢SQL
      1. 没有索引
      2. ...
3. 服务器问题
   1. 资源不足（CPU/内存/带宽/磁盘）
   2. 系统的连接数问题

## 系统TOP命令

![](/assets/yace/kaipian/top.png)

### us

用户CPU时间（非内核进程占用时间）（单位百分比）。us的值比较高时，说明用户进程消耗的CPU时间多

* 频繁FULL GC

* 代码有非常消耗CPU的操作，例如死循环

### sy

系统使用CPU时间（单位百分比）。sy的值高时，说明内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因。

* 锁竞争激烈

* 线程主动切换频繁

### wa

等待IO的CPU时间，wait越大则机器io性能就越差。说明IO等待比较严重，这可能由于磁盘大量操作随机访问造成，也有可能磁盘出现瓶颈（块操作）

* io读写频繁



## 实施

* Jmeter
* Jvisual



